files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_install_nodejs.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # Install Node.js 18.x (LTS)
      echo "Installing Node.js for React builds..."
      
      # Check if Node.js is already installed
      if command -v node &> /dev/null; then
        echo "Node.js already installed: $(node --version)"
        if command -v npm &> /dev/null; then
          echo "npm already installed: $(npm --version)"
        fi
        if command -v yarn &> /dev/null; then
          echo "yarn already installed: $(yarn --version)"
        else
          echo "Installing yarn..."
          npm install -g yarn || echo "yarn installation failed, will use npm"
        fi
      else
        echo "Installing Node.js..."
        
        # Install Node.js via NodeSource repository
        curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
        sudo yum install -y nodejs
        
        # Verify installation
        if command -v node &> /dev/null; then
          echo "Node.js installed successfully: $(node --version)"
          echo "npm installed: $(npm --version)"
          
          # Install yarn globally
          npm install -g yarn
          echo "yarn installed: $(yarn --version)"
        else
          echo "ERROR: Node.js installation failed"
          exit 1
        fi
      fi
      
      echo "Node.js setup complete!"

commands:
  01_install_nodejs:
    command: "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_install_nodejs.sh"
    ignoreErrors: false

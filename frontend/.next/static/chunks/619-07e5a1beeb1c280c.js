"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[619],{2869:function(e,t,r){r.d(t,{z:function(){return c}});var o=r(7437),a=r(2265),i=r(7495),n=r(535),s=r(4508);let l=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,o.jsx)(u,{className:(0,s.cn)(l({variant:a,size:n,className:r})),ref:t,...d})});c.displayName="Button"},9179:function(e,t,r){r.d(t,{Ho:function(){return s},aC:function(){return l}});var o=r(7437),a=r(2265),i=r(9376);let n=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),h=(0,i.useRouter)(),f="http://localhost:8000",g="codeflowops_access_token",p="codeflowops_refresh_token",m="codeflowops_user",w=e=>"string"==typeof e?{code:"UNKNOWN_ERROR",message:e}:e?.detail&&"string"==typeof e.detail?e.detail.includes("Auth flow not enabled")?{code:"COGNITO_AUTH_FLOW_ERROR",message:"Authentication method not configured properly",details:"Please contact support - authentication service needs configuration"}:e.detail.includes("User does not exist")||e.detail.includes("Incorrect username or password")?{code:"INVALID_CREDENTIALS",message:"Invalid email or password"}:e.detail.includes("User already exists")?{code:"USER_EXISTS",message:"An account with this email already exists"}:e.detail.includes("Password does not conform to policy")?{code:"WEAK_PASSWORD",message:"Password does not meet requirements",details:"Password must contain uppercase, lowercase, number and special character"}:{code:"API_ERROR",message:e.detail}:{code:"NETWORK_ERROR",message:e?.message||"Network error occurred"},y=()=>localStorage.getItem(g),v=()=>localStorage.getItem(p),E=()=>{let e=localStorage.getItem(m);return e?JSON.parse(e):null},b=e=>{localStorage.setItem(g,e.access_token),e.refresh_token&&localStorage.setItem(p,e.refresh_token),localStorage.setItem(m,JSON.stringify(e.user)),s(e.user)},k=()=>{localStorage.removeItem(g),localStorage.removeItem(p),localStorage.removeItem(m),s(null)},S=async e=>{try{let t=await fetch(`${f}/api/v1/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({detail:"Login failed"})),r=w(e);throw Error(r.message)}let r=await t.json();b(r)}catch(e){if(console.error("Login error:",e),e instanceof Error)throw e;throw Error("Login failed due to network error")}},_=async e=>{try{let t=await fetch(`${f}/api/v1/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({detail:"Registration failed"})),r=w(e);throw Error(r.message)}let r=await t.json();b(r)}catch(e){if(console.error("Registration error:",e),e instanceof Error)throw e;throw Error("Registration failed due to network error")}},P=async()=>{try{let e=await fetch(`${f}/api/v1/auth/config`);if(!e.ok)return null;let t=await e.json();return{region:t.cognito?.region||"us-east-1",userPoolId:t.cognito?.userPoolId||"",clientId:t.cognito?.clientId||"",domain:t.cognito?.domain,redirectUri:t.cognito?.redirectUri}}catch(e){return console.error("Failed to get Cognito config:",e),null}},j=async e=>{try{let t=await fetch(`${f}/api/v1/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){let e=await t.json().catch(()=>({detail:"Password reset failed"})),r=w(e);throw Error(r.message)}}catch(e){if(console.error("Password reset error:",e),e instanceof Error)throw e;throw Error("Password reset failed due to network error")}},I=async()=>{try{if(r?.provider==="github")await fetch(`${f}/auth/github/logout`,{method:"POST",credentials:"include"});else{let e=y();e&&await fetch(`${f}/api/v1/auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`}})}}catch(e){console.error("Logout error:",e)}finally{k(),h.push("/login")}},N=async()=>{try{let e=y();if(!e)throw Error("No access token found");let t=await fetch(`${f}/api/v1/auth/profile`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch profile");return await t.json()}catch(e){throw console.error("Error fetching profile:",e),e}},O=async e=>{try{let t=y();if(!t)throw Error("No access token found");let r=await fetch(`${f}/api/v1/auth/profile`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Failed to update profile");let o=await r.json();return s(o.user),o}catch(e){throw console.error("Error updating profile:",e),e}},R=async()=>{try{let e=y();if(!e)throw Error("No access token found");let t=await fetch(`${f}/api/v1/auth/deployments`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch deployments");return await t.json()}catch(e){throw console.error("Error fetching deployments:",e),e}},T=async()=>{try{let e=y();if(!e)throw Error("No access token found");let t=await fetch(`${f}/api/v1/auth/deployments/clear`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to clear deployment history");return await t.json()}catch(e){throw console.error("Error clearing deployment history:",e),e}},$=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((a,i)=>{let n=document.createElement("canvas"),s=n.getContext("2d"),l=new Image;l.onload=()=>{let{width:e,height:i}=l;e>i?e>t&&(i=i*t/e,e=t):i>r&&(e=e*r/i,i=r),n.width=e,n.height=i,s?.drawImage(l,0,0,e,i),a(n.toDataURL("image/jpeg",o))},l.onerror=()=>i(Error("Failed to load image")),l.src=URL.createObjectURL(e)})},A=async e=>{try{if(!e.type.startsWith("image/"))throw Error("Please select a valid image file.");if(e.size>5242880)throw Error("Please select an image smaller than 5MB.");let t=await $(e,200,200,.8);u(t),r?.id&&localStorage.setItem(`profile_picture_${r.id}`,t),console.log("Profile picture updated successfully")}catch(e){throw console.error("Error updating profile picture:",e),e}};(0,a.useEffect)(()=>{if(r?.id){let e=localStorage.getItem(`profile_picture_${r.id}`);e?u(e):u(null)}else u(null)},[r?.id]);let x=async()=>{try{let e=v();if(!e)throw Error("No refresh token available");let t=await fetch(`${f}/api/v1/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)throw Error("Token refresh failed");let r=await t.json();b(r)}catch(e){console.error("Token refresh error:",e),k(),h.push("/login")}},C=async()=>{try{let e=await fetch(`${f}/auth/github/user`,{credentials:"include"});if(e.ok){let t=await e.json();if(t.authenticated&&t.user)return s({id:t.user.id,email:t.user.email,name:t.user.name||t.user.login,username:t.user.login,provider:"github"}),!0}return!1}catch(e){return console.error("GitHub auth check error:",e),!1}};return(0,a.useEffect)(()=>{(async()=>{try{if(!await C()){let e=E(),t=y();if(e&&t){let r=await fetch(`${f}/api/health`,{headers:{Authorization:`Bearer ${t}`}});if(r.ok)s(e);else if(401===r.status)try{await x()}catch{k()}else k()}}}catch(e){console.error("Auth initialization error:",e),k()}finally{c(!1)}})()},[]),(0,o.jsx)(n.Provider,{value:{user:r,loading:l,isAuthenticated:!!r,login:S,register:_,logout:I,refreshToken:x,getCognitoConfig:P,resetPassword:j,fetchUserProfile:N,updateUserProfile:O,fetchUserDeployments:R,clearDeploymentHistory:T,profilePicture:d,updateProfilePicture:A,removeProfilePicture:()=>{u(null),r?.id&&localStorage.removeItem(`profile_picture_${r.id}`),console.log("Profile picture removed successfully")}},children:t})}function l(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4508:function(e,t,r){r.d(t,{cn:function(){return i}});var o=r(1994),a=r(3335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,o.W)(t))}}}]);